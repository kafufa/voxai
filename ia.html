<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoxAI - Asistente de Voz</title>
    <link rel="stylesheet" href="https://kafufa.github.io/voxai/styles2.css">
</head>
<body>
    <div class="container">
        <h1>VoxAI - Tu Asistente de Voz personal</h1>
        <p>Este asistente está impulsado por DeepSeek a través de OpenRouter.</p>
        
        <!-- Botón de voz original -->
        <button id="start-btn">🎤 Hablar</button>
        
        <!-- Botón para navegar a la página de apartados -->
        <button id="navigate-btn">Ir a Apartados</button>
        
        <!-- Casilla de texto y botón de enviar -->
        <div class="input-container">
            <input type="text" id="text-input" placeholder="Escribe tu pregunta aquí...">
            <button id="send-btn">Enviar</button>
        </div>
        
        <p id="response">Esperando comando...</p>
    </div>
    
    <script>
        // Configuración de la API de OpenRouter
        const OPENROUTER_API_KEY = "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";
        
        // Función para procesar consultas usando OpenRouter
        async function processQuery(query) {
            document.getElementById("response").innerText = "Procesando: " + query;
            
            try {
                // Usamos un servicio proxy para evitar problemas de CORS
                // Otra opción es utilizar un backend propio
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    mode: "cors", // Explícitamente habilitamos CORS
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${OPENROUTER_API_KEY}`,
                        "HTTP-Referer": window.location.href,
                        "X-Title": "VoxAI",
                        "OpenRouter-Completions-Fallback-Model": "deepseek/deepseek-chat"
                    },
                    body: JSON.stringify({
                        model: "openrouter/auto", // Modelo automático con preferencia por DeepSeek
                        route: "openrouter",
                        messages: [
                            { "role": "user", "content": query }
                        ],
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                document.getElementById("response").innerText = aiResponse;
                
                // Convertir texto a voz
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(aiResponse);
                    utterance.lang = "es-ES";
                    speechSynthesis.speak(utterance);
                }
            } catch (error) {
                console.error("Error detallado:", error);
                
                // Método alternativo usando un servicio de respaldo
                try {
                    document.getElementById("response").innerText = "Intentando método alternativo...";
                    
                    // Simulamos una respuesta básica para demostrar que la interfaz funciona
                    setTimeout(() => {
                        const respuesta = "Lo siento, no puedo conectarme a la API en este momento. Este es un mensaje de respaldo para demostrar que la interfaz funciona. Por favor, verifica tu conexión a Internet y la configuración de la API.";
                        document.getElementById("response").innerText = respuesta;
                        
                        if ('speechSynthesis' in window) {
                            const utterance = new SpeechSynthesisUtterance(respuesta);
                            utterance.lang = "es-ES";
                            speechSynthesis.speak(utterance);
                        }
                    }, 1000);
                } catch (fallbackError) {
                    document.getElementById("response").innerText = "Error: No se pudo procesar tu consulta. Por favor, intenta de nuevo más tarde.";
                }
            }
        }
        
        // Funcionalidad del botón de voz
        document.getElementById("start-btn").addEventListener("click", () => {
            try {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = "es-ES";
                recognition.start();
                
                document.getElementById("response").innerText = "Escuchando...";
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    processQuery(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.error("Error en el reconocimiento de voz:", event.error);
                    document.getElementById("response").innerText = "Error: No se pudo reconocer tu voz. Por favor, intenta de nuevo.";
                };
            } catch (error) {
                console.error("Error al iniciar el reconocimiento de voz:", error);
                document.getElementById("response").innerText = "Error: El reconocimiento de voz no está disponible en tu navegador.";
            }
        });
        
        // Funcionalidad del botón de navegación
        document.getElementById("navigate-btn").addEventListener("click", () => {
            window.location.href = "https://kafufa.github.io/voxai/apartados.html";
        });
        
        // Funcionalidad de la casilla de texto y botón de enviar
        document.getElementById("send-btn").addEventListener("click", handleTextInput);
        document.getElementById("text-input").addEventListener("keypress", (event) => {
            if (event.key === "Enter") {
                handleTextInput();
            }
        });
        
        function handleTextInput() {
            const textInput = document.getElementById("text-input").value;
            if (textInput.trim() !== "") {
                processQuery(textInput);
                document.getElementById("text-input").value = ""; // Limpiar el campo después de enviar
            }
        }
    </script>
</body>
</html>
