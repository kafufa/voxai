<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoxAI - Asistente de Voz</title>
    <link rel="stylesheet" href="https://kafufa.github.io/voxai/styles2.css">
</head>
<body>
    <div class="container">
        <h1>VoxAI - Tu Asistente de Voz personal</h1>
        <p>Este asistente est치 impulsado por DeepSeek.</p>
        
        <!-- Bot칩n de voz original -->
        <button id="start-btn">游꿗 Hablar</button>
        
        <!-- Bot칩n para navegar a la p치gina de apartados -->
        <button id="navigate-btn">Ir a Apartados</button>
        
        <!-- Casilla de texto y bot칩n de enviar -->
        <div class="input-container">
            <input type="text" id="text-input" placeholder="Escribe tu pregunta aqu칤...">
            <button id="send-btn">Enviar</button>
        </div>
        
        <p id="response">Esperando comando...</p>
    </div>
    
    <script>
        // Configuraci칩n de la API - Aseg칰rate de que esta URL coincida con donde est치 desplegado tu servidor
        const API_URL = "/api/ask"; // Actualiza esta URL seg칰n donde est칠 desplegado tu servidor
        
        // Funci칩n para procesar consultas (tanto de voz como de texto)
        async function processQuery(query) {
            document.getElementById("response").innerText = "Procesando: " + query;
            
            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query: query })
                });
                
                if (!response.ok) {
                    throw new Error("Error en la respuesta del servidor");
                }
                
                const data = await response.json();
                document.getElementById("response").innerText = "Respuesta: " + data.response;
            } catch (error) {
                console.error("Error al procesar la consulta:", error);
                document.getElementById("response").innerText = "Error: No se pudo procesar tu consulta. Por favor, intenta de nuevo.";
            }
        }
        
        // Funcionalidad del bot칩n de voz (original)
        document.getElementById("start-btn").addEventListener("click", () => {
            try {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = "es-ES";
                recognition.start();
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    processQuery(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.error("Error en el reconocimiento de voz:", event.error);
                    document.getElementById("response").innerText = "Error: No se pudo reconocer tu voz. Por favor, intenta de nuevo.";
                };
            } catch (error) {
                console.error("Error al iniciar el reconocimiento de voz:", error);
                document.getElementById("response").innerText = "Error: El reconocimiento de voz no est치 disponible en tu navegador.";
            }
        });
        
        // Funcionalidad del bot칩n de navegaci칩n
        document.getElementById("navigate-btn").addEventListener("click", () => {
            window.location.href = "https://kafufa.github.io/voxai/apartados.html";
        });
        
        // Funcionalidad de la casilla de texto y bot칩n de enviar
        document.getElementById("send-btn").addEventListener("click", handleTextInput);
        document.getElementById("text-input").addEventListener("keypress", (event) => {
            if (event.key === "Enter") {
                handleTextInput();
            }
        });
        
        function handleTextInput() {
            const textInput = document.getElementById("text-input").value;
            if (textInput.trim() !== "") {
                processQuery(textInput);
                document.getElementById("text-input").value = ""; // Limpiar el campo despu칠s de enviar
            }
        }
        
        // Verificar si el servidor est치 disponible al cargar la p치gina
        window.addEventListener("load", async () => {
            try {
                const response = await fetch(API_URL.replace("/ask", "/status"), {
                    method: "GET"
                });
                
                if (!response.ok) {
                    console.warn("El servidor API podr칤a no estar disponible");
                }
            } catch (error) {
                console.warn("No se pudo conectar con el servidor API", error);
            }
        });
    </script>
</body>
</html>
