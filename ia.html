<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoxAI - Asistente de Voz</title>
    <link rel="stylesheet" href="styles2.css">
</head>
<body>
    <div id="assistant-container" class="container">
        <h1>ğŸ¤– VoxAI - Asistente de Voz</h1>
        <p>Habla o escribe para interactuar con la IA de DeepSeek.</p>
        <button id="start-btn" class="btn talk">ğŸ¤ Hablar</button>
        <button id="stop-btn" class="btn stop" style="display: none;">ğŸ›‘ Parar</button>
        <input type="text" id="text-input" class="input-box" placeholder="Escribe tu mensaje aquÃ­...">
        <button id="send-btn" class="btn send">ğŸ“© Enviar</button>
        <p id="response" class="response-box">Esperando comando...</p>
    </div>
    <div>
        <button class="nav-button" onclick="location.href='apartados.html'">Apartados</button>
    </div>
   
    <script>
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const textInput = document.getElementById('text-input');
        const sendBtn = document.getElementById('send-btn');
        const responseBox = document.getElementById('response');
       
        let recognition;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        function initializeSpeechRecognition() {
            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.lang = 'es-ES';
                recognition.continuous = true;
               
                recognition.onstart = function() {
                    startBtn.style.display = 'none';
                    stopBtn.style.display = 'inline-block';
                    responseBox.textContent = 'Escuchando...';
                };
               
                recognition.onresult = function(event) {
                    const transcript = Array.from(event.results).map(result => result[0].transcript).join('');
                    textInput.value = transcript;
                };
               
                recognition.onend = function() {
                    startBtn.style.display = 'inline-block';
                    stopBtn.style.display = 'none';
                    responseBox.textContent = 'Reconocimiento de voz detenido.';
                };
               
                recognition.onerror = function(event) {
                    responseBox.textContent = `Error de reconocimiento: ${event.error}`;
                };
            } else {
                startBtn.disabled = true;
                startBtn.textContent = 'ğŸš« No soportado';
                responseBox.textContent = 'Tu navegador no soporta reconocimiento de voz.';
            }
        }
       
        async function sendToAPI(message) {
            try {
                responseBox.textContent = `TÃº: ${message}\n\nConectando con la IA...`;
                const response = await fetch('https://github.com/kafufa/voxai/backend/server.js', { // AsegÃºrate de reemplazar esta URL con la del backend correcto
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query: message })
                });
               
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
               
                const data = await response.json();
                return data.response || "La API no devolviÃ³ una respuesta vÃ¡lida.";
            } catch (error) {
                console.error("Error al conectarse al backend:", error);
                return `Error: ${error.message}`;
            }
        }
       
        async function processMessage() {
            const userMessage = textInput.value.trim();
            if (!userMessage) return;

            responseBox.textContent = `Procesando tu mensaje: "${userMessage}"...`;
           
            try {
                const apiResponse = await sendToAPI(userMessage);
                responseBox.textContent = `Asistente: ${apiResponse}`;
            } catch (error) {
                responseBox.textContent = `Hubo un error: ${error.message}`;
            }
           
            textInput.value = '';
        }
       
        document.addEventListener('DOMContentLoaded', initializeSpeechRecognition);
        startBtn.addEventListener('click', () => recognition && recognition.start());
        stopBtn.addEventListener('click', () => recognition && recognition.stop());
        sendBtn.addEventListener('click', processMessage);
        textInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') processMessage(); });
    </script>
</body>
</html>

